{% extends "base.html" %}

{% block title %}Search - YouTube Audio Downloader{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- Search header -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-6">
            <div>
                <h1 class="text-2xl font-bold text-gray-900 mb-2">Search YouTube</h1>
                <p class="text-gray-600">Find and download your favorite music</p>
            </div>
        </div>
        
        <!-- Search form -->
        <form id="search-form" class="flex space-x-3">
            <div class="flex-1">
                <input type="text" 
                       id="search-input" 
                       placeholder="Search for artists, songs, albums..." 
                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg"
                       value="{{ request.args.get('q', '') }}">
            </div>
            <button type="submit" 
                    class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-colors flex items-center">
                <i class="fas fa-search mr-2"></i>Search
            </button>
        </form>
    </div>
    
    <!-- Search results -->
    <div id="search-results" class="space-y-4">
        {% if request.args.get('q') %}
        <!-- Loading state -->
        <div id="loading-state" class="text-center py-12">
            <div class="spinner w-8 h-8 border-2 border-gray-300 border-t-blue-600 rounded-full mx-auto mb-4"></div>
            <p class="text-gray-600">Searching YouTube...</p>
        </div>
        {% else %}
        <!-- Empty state -->
        <div class="text-center py-16 bg-white rounded-lg shadow-sm border border-gray-200">
            <i class="fas fa-search text-6xl text-gray-300 mb-4"></i>
            <h3 class="text-xl font-semibold text-gray-900 mb-2">Start Your Search</h3>
            <p class="text-gray-600 max-w-md mx-auto">
                Enter an artist name, song title, or any keywords to find YouTube videos to download as MP3 audio files.
            </p>
            <div class="mt-6">
                <div class="flex flex-wrap justify-center gap-2 text-sm">
                    <span class="text-gray-500">Try:</span>
                    <button class="search-suggestion bg-gray-100 hover:bg-gray-200 px-3 py-1 rounded-full text-gray-700 transition-colors" data-query="Taylor Swift">
                        Taylor Swift
                    </button>
                    <button class="search-suggestion bg-gray-100 hover:bg-gray-200 px-3 py-1 rounded-full text-gray-700 transition-colors" data-query="The Weeknd">
                        The Weeknd
                    </button>
                    <button class="search-suggestion bg-gray-100 hover:bg-gray-200 px-3 py-1 rounded-full text-gray-700 transition-colors" data-query="Billie Eilish">
                        Billie Eilish
                    </button>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
    
    <!-- Results container -->
    <div id="results-container" class="hidden">
        <!-- Results header -->
        <div id="results-header" class="bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-4">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between">
                <div>
                    <h3 class="font-semibold text-gray-900">Search Results</h3>
                    <p id="results-info" class="text-sm text-gray-600"></p>
                </div>
                <div class="mt-3 md:mt-0 flex items-center space-x-3">
                    <button id="select-all" class="text-sm text-blue-600 hover:text-blue-800 font-medium">
                        Select All
                    </button>
                    <button id="add-selected" class="bg-youtube hover:bg-youtube-dark text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors flex items-center">
                        <i class="fas fa-plus mr-2"></i>Add Selected (<span id="selected-count">0</span>)
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Results grid -->
        <div id="results-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
            <!-- Results will be populated here -->
        </div>
        
        <!-- Pagination -->
        <div id="pagination" class="bg-white rounded-lg shadow-sm border border-gray-200 p-4">
            <div class="flex items-center justify-between">
                <button id="prev-page" class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-medium transition-colors flex items-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <i class="fas fa-chevron-left mr-2"></i>Previous
                </button>
                
                <div class="flex items-center space-x-2">
                    <span class="text-sm text-gray-600">Page</span>
                    <span id="current-page" class="font-semibold text-gray-900">1</span>
                    <span class="text-sm text-gray-600">of</span>
                    <span id="total-pages" class="font-semibold text-gray-900">1</span>
                </div>
                
                <button id="next-page" class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-medium transition-colors flex items-center disabled:opacity-50 disabled:cursor-not-allowed">
                    Next<i class="fas fa-chevron-right ml-2"></i>
                </button>
            </div>
            
            <!-- Load more button (for lazy loading) -->
            <div class="mt-4 text-center">
                <button id="load-more" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium transition-colors hidden">
                    <i class="fas fa-plus mr-2"></i>Load More Results
                </button>
            </div>
        </div>
    </div>
    
    <!-- No results -->
    <div id="no-results" class="text-center py-12 bg-white rounded-lg shadow-sm border border-gray-200 hidden">
        <i class="fas fa-search text-4xl text-gray-300 mb-4"></i>
        <h3 class="text-lg font-semibold text-gray-900 mb-2">No Results Found</h3>
        <p class="text-gray-600 mb-4">We couldn't find any videos matching your search.</p>
        <button id="try-again" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
            Try Another Search
        </button>
    </div>
</div>

<!-- Video result template -->
<template id="video-result-template">
    <div class="video-result bg-white rounded-lg shadow-sm border border-gray-200 hover-lift transition-all duration-200 cursor-pointer">
        <div class="relative">
            <img class="video-thumbnail w-full h-48 object-cover rounded-t-lg" src="" alt="Video thumbnail">
            <div class="video-duration absolute bottom-2 right-2 bg-black bg-opacity-75 text-white text-xs px-2 py-1 rounded"></div>
            <div class="video-select absolute top-2 left-2">
                <input type="checkbox" class="w-5 h-5 text-youtube bg-white border-2 border-white rounded focus:ring-youtube focus:ring-2">
            </div>
        </div>
        <div class="p-4">
            <h4 class="video-title font-semibold text-gray-900 text-sm mb-2 line-clamp-2" title=""></h4>
            <p class="video-channel text-gray-600 text-sm mb-3"></p>
            <div class="flex items-center justify-between">
                <button class="add-single bg-youtube hover:bg-youtube-dark text-white px-3 py-1 rounded text-xs font-medium transition-colors flex items-center">
                    <i class="fas fa-plus mr-1"></i>Add
                </button>
                <button class="preview-btn text-gray-600 hover:text-gray-800 text-xs flex items-center">
                    <i class="fas fa-external-link-alt mr-1"></i>Preview
                </button>
            </div>
        </div>
    </div>
</template>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/search.js') }}"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize search functionality
    if (typeof Search !== 'undefined') {
        Search.init();
    }
    
    // Auto-search if query parameter is present
    const urlParams = new URLSearchParams(window.location.search);
    const query = urlParams.get('q');
    if (query) {
        Search.performSearch(query);
    }
    
    // Search form submission
    const searchForm = document.getElementById('search-form');
    if (searchForm) {
        searchForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const query = document.getElementById('search-input').value.trim();
            if (query) {
                Search.performSearch(query);
                // Update URL without page reload
                const newUrl = new URL(window.location);
                newUrl.searchParams.set('q', query);
                window.history.pushState({}, '', newUrl);
            }
        });
    }
    
    // Search suggestions
    const suggestions = document.querySelectorAll('.search-suggestion');
    suggestions.forEach(suggestion => {
        suggestion.addEventListener('click', function() {
            const query = this.dataset.query;
            document.getElementById('search-input').value = query;
            Search.performSearch(query);
        });
    });
    
    // Pagination controls
    const prevBtn = document.getElementById('prev-page');
    const nextBtn = document.getElementById('next-page');
    const loadMoreBtn = document.getElementById('load-more');
    
    if (prevBtn) {
        prevBtn.addEventListener('click', () => Search.previousPage());
    }
    
    if (nextBtn) {
        nextBtn.addEventListener('click', () => Search.nextPage());
    }
    
    if (loadMoreBtn) {
        loadMoreBtn.addEventListener('click', () => Search.loadMore());
    }
    
    // Bulk selection controls
    const selectAllBtn = document.getElementById('select-all');
    const addSelectedBtn = document.getElementById('add-selected');
    
    if (selectAllBtn) {
        selectAllBtn.addEventListener('click', () => Search.toggleSelectAll());
    }
    
    if (addSelectedBtn) {
        addSelectedBtn.addEventListener('click', () => Search.addSelected());
    }
    
    // Try again button
    const tryAgainBtn = document.getElementById('try-again');
    if (tryAgainBtn) {
        tryAgainBtn.addEventListener('click', function() {
            document.getElementById('search-input').focus();
        });
    }
});
</script>
{% endblock %}